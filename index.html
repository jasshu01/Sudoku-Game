<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
        * {
            padding: 0%;
            margin: 0%;
        }
        
        nav {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
            color: white;
            height: 10vh;
            font-size: 30px;
        }
        
        nav h1 {
            margin-right: 10vw;
        }
        
        .game {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .board {
            /* border: 4px solid red; */
            display: grid;
            width: 36vw;
            height: 36vw;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            justify-content: center;
            align-items: center;
            margin-top: 2vh;
        }
        
        .miniBox {
            border: 1px solid black;
            height: 4vw;
            width: 4vw;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: poleter;
        }
        
        .input {
            display: grid;
            width: 12vw;
            height: 12vw;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            justify-content: center;
            align-items: center;
            margin-top: 2vh;
            margin-left: 20vw;
        }
        
        .number {
            width: 4vw;
            height: 4vw;
            border: 2px solid red;
            font-size: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .number button {
            width: 4vw;
            height: 4vw;
            border: 2px solid red;
            font-size: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .btns {
            width: 8vw;
            height: 4vw;
            border: 2px solid red;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-top: 2vh;
            margin-right: 10px;
        }
        
        #duration {
            width: 30vw;
        }
    </style>
</head>

<body>
    <nav>
        <h1>Play Sudoku!</h1>
        <div id="dur" style="display: flex">
            Duration : <span id="duration"> </span>
        </div>
    </nav>
    <div class="game">
        <div class="board">
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>

            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
            <div class="miniBox"></div>
        </div>

        <div>
            <div class="input">
                <div class="number"><button class="inBtn">1</button></div>
                <div class="number"><button class="inBtn">2</button></div>
                <div class="number"><button class="inBtn">3</button></div>
                <div class="number"><button class="inBtn">4</button></div>
                <div class="number"><button class="inBtn">5</button></div>
                <div class="number"><button class="inBtn">6</button></div>
                <div class="number"><button class="inBtn">7</button></div>
                <div class="number"><button class="inBtn">8</button></div>
                <div class="number"><button class="inBtn">9</button></div>
            </div>

            <div class="input">
                <button class="btns" id="StartGame">Start Game</button>
                <button class="btns" id="ResetGame">Reset Game</button>
            </div>
        </div>
    </div>

    <script>
        for (i = 0; i < 9; i++) {
            for (j = 0; j < 9; j++) {
                if (i == 0)
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.borderTop = "3px solid red";

                if (i == 8)
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.borderBottom = "3px solid red";

                if (j == 0)
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.borderLeft = "3px solid red";

                if (j == 8)
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.borderRight = "3px solid red";

                if (i % 3 == 0)
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.borderTop = "3px solid red";
                if (j % 3 == 0)
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.borderLeft = "3px solid red";
            }
        }

        document.getElementById("StartGame").style.display = "block";
        document.getElementById("ResetGame").style.display = "none";
        document.getElementById("dur").style.display = "none";
        let btns = document.getElementsByClassName("inBtn");
        let locked = false;
        let changeIn, idx1, idx2;
        let bigBoxes = document.getElementsByClassName("box");
        let prevIndex;
        let miniBoxes = document.getElementsByClassName("miniBox");
        let positions = [];
        let board = new Array(9);
        let stTime = StartTime();
        for (i = 0; i < 9; i++) {
            board[i] = new Array(9);
        }

        document
            .getElementById("StartGame")
            .addEventListener("click", function() {
                createGame();
                stTime = StartTime();
                document.getElementById("dur").style.display = "block";

                document.getElementById("duration").innerHTML = " 00:00:00";
                document.getElementById("StartGame").style.display = "none";

                document.getElementById("ResetGame").style.display = "block";
            });

        document
            .getElementById("ResetGame")
            .addEventListener("click", function() {
                document.getElementById("StartGame").style.display = "block";
                document.getElementById("ResetGame").style.display = "block";
                document.getElementById("duration").style.display = "none";
                for (i = 0; i < 9; i++)
                    for (j = 0; j < 9; j++) board[i][j] = "";

                for (i = 0; i < 81; i++) {
                    miniBoxes[i].innerText = "";
                }
            });

        function createGame() {
            locked = false;
            changeIn = undefined;
            prevIndex = undefined;

            for (i = 0; i < 9; i++)
                for (j = 0; j < 9; j++) board[i][j] = "";

            positions = [];

            const values = [];
            for (k = 0; k < 17; k++) {
                let pos = Math.floor(Math.random() * 81);

                while (positions.includes(pos)) {
                    pos = Math.floor(Math.random() * 81);
                }
                let val = Math.floor(Math.random() * 9) + 1;

                index1 = Math.floor(pos / 9);
                index2 = pos - index1 * 9;
                // //console.log(pos, index1, index2);
                board[index1][index2] = val;

                positions.push(pos);
                values.push(val);
            }
            if (isValidSudoku(board)) {
                // console.log("valid");
                stTime = StartTime();
                for (i = 0; i < 9; i++) {
                    for (j = 0; j < 9; j++) {
                        let idx = i * 9 + j;
                        let miniBox = document.getElementsByClassName("miniBox")[idx];
                        miniBox.innerText = board[i][j];
                        miniBox.style.fontSize = "4rem";
                        miniBox.style.color = "green";
                        miniBox.style.fontWeight = "bold";
                        miniBox.style.cursor = "pointer";
                        miniBox.addEventListener("click", () => {});
                    }
                }
                Array.from(miniBoxes).forEach((miniElement, index) => {
                    if (!positions.includes(index)) {
                        miniElement.addEventListener("click", () => {
                            if (prevIndex !== undefined) {
                                locked = false;
                                clear(prevIndex);
                            }
                            miniElement.innerText = "1";

                            document.getElementsByClassName("inBtn")[0].click();
                            locked = true;

                            changeIn = miniElement;
                            prevIndex = index;
                            show(index, "yellow");
                        });
                    }
                });

                Array.from(miniBoxes).forEach((miniElement, index) => {
                    miniElement.addEventListener("mouseenter", () => {
                        show(index, "lightblue");
                    });

                    miniElement.addEventListener("mouseout", () => {
                        if (prevIndex !== index) {
                            clear(index);
                            if (prevIndex != undefined) show(prevIndex, "yellow");
                        }
                    });
                });

                Array.from(btns).forEach((element) => {
                    element.addEventListener("click", () => {
                        if (changeIn === undefined) return;

                        changeIn.innerText = element.innerText;
                        // console.log(idx1, idx2);
                        board[idx1][idx2] = parseInt(element.innerText);

                        emptyCell = false;
                        for (i = 0; i < 9; i++)
                            if (board[i].includes("")) emptyCell = true;

                        console.log(emptyCell);

                        if (!emptyCell) {
                            if (isValidSudoku(board))
                                document.getElementsByClassName("board")[0].innerHTML =
                                "YOU SOLVED IT!";
                        }
                    });
                });

                return;
            } else {
                // console.log("invalid");
                createGame();
            }

            //console.log(positions);
            //console.log(values);
        }

        function isValidSudoku(board) {
            let row = new Array(9),
                col = new Array(9),
                box = new Array(3);

            for (i = 0; i < 9; i++) row[i] = new Array();
            for (i = 0; i < 9; i++) col[i] = new Array();

            for (i = 0; i < 3; i++) {
                box[i] = new Array(3);
                for (j = 0; j < 3; j++) {
                    box[i][j] = new Array(9);
                }
            }

            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] == "") continue;
                    p = Math.floor(i / 3);
                    q = Math.floor(j / 3);

                    if (
                        row[i].includes(board[i][j]) ||
                        col[j].includes(board[i][j]) ||
                        box[p][q].includes(board[i][j])
                    )
                        return false;

                    row[i].push(board[i][j]);
                    col[j].push(board[i][j]);
                    box[p][q].push(board[i][j]);
                }
            }
            // console.log(row, col, box);
            return true;
        }

        function hilightRow(index, clr) {
            for (j = 0; j < 9; j++) {
                document.getElementsByClassName("miniBox")[
                    index * 9 + j
                ].style.backgroundColor = clr;
            }
        }

        function hilightCol(index2, clr) {
            for (j = 0; j < 9; j++) {
                document.getElementsByClassName("miniBox")[
                    index2 + 9 * j
                ].style.backgroundColor = clr;
            }
        }

        function hilightBox(index1, index2, clr) {
            index1 = Math.floor(index1) * 3;
            index2 = Math.floor(index2) * 3;

            for (i = index1; i < index1 + 3; i++) {
                for (j = index2; j < index2 + 3; j++) {
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.backgroundColor = clr;
                }
            }
        }

        function show(index, clr) {
            index1 = Math.floor(index / 9);
            index2 = index - index1 * 9;
            idx1 = index1;
            idx2 = index2;
            //console.log(index, index1, index2);
            hilightCol(index2, clr);
            hilightRow(index1, clr);
            hilightBox(index1 / 3, index2 / 3, clr);

            document.getElementsByClassName("miniBox")[
                index
            ].style.backgroundColor = "red";
        }

        function clear(index) {
            index1 = Math.floor(index / 9);
            index2 = index - index1 * 9;

            for (j = 0; j < 9; j++) {
                document.getElementsByClassName("miniBox")[
                    index1 * 9 + j
                ].style.backgroundColor = "white";
            }
            for (j = 0; j < 9; j++) {
                document.getElementsByClassName("miniBox")[
                    index2 + 9 * j
                ].style.backgroundColor = "white";
            }

            index1 = Math.floor(index1 / 3) * 3;
            index2 = Math.floor(index2 / 3) * 3;
            for (i = index1; i < index1 + 3; i++) {
                for (j = index2; j < index2 + 3; j++) {
                    document.getElementsByClassName("miniBox")[
                        i * 9 + j
                    ].style.backgroundColor = "white";
                }
            }
        }

        function StartTime() {
            var startTime = new Date();
            var startHours = startTime.getHours();
            var startMinutes = startTime.getMinutes();
            var startSeconds = startTime.getSeconds();
            var startAmPm = startHours >= 12 ? "PM" : "AM";
            startHours = startHours % 12;
            startHours = startHours ? startHours : 12; // the hour '0' should be '12'
            startMinutes = startMinutes < 10 ? "0" + startMinutes : startMinutes;
            startSeconds = startSeconds < 10 ? "0" + startSeconds : startSeconds;
            var startStrTime =
                startHours +
                ":" +
                startMinutes +
                ":" +
                startSeconds +
                " " +
                startAmPm;

            return startTime;
        }

        Timer();

        function Timer() {
            var time = new Date();
            var hours = time.getHours();
            var minutes = time.getMinutes();
            var seconds = time.getSeconds();
            var ampm = hours >= 12 ? "PM" : "AM";
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            var strTime = hours + ":" + minutes + ":" + seconds + " " + ampm;

            d = Number(time - stTime) / 1000;
            var h = Math.floor(d / 3600);
            var m = Math.floor((d % 3600) / 60);
            var s = Math.floor((d % 3600) % 60);

            var hDisplay = h > 0 ? h + (h == 1 ? " hour, " : " hours, ") : "";
            var mDisplay = m > 0 ? m + (m == 1 ? " minute, " : " minutes, ") : "";
            var sDisplay = s > 0 ? s + (s == 1 ? " second" : " seconds") : "";

            document.getElementById("duration").innerHTML =
                " " + hDisplay + mDisplay + sDisplay;
            setTimeout(Timer, 1000);
        }
    </script>
</body>

</html>